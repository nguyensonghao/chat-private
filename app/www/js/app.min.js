"use strict";var localstoreSerive=angular.module("mazii.service.localstore",[]);localstoreSerive.factory("localstoreServ",[function(){var a={};return a.setItem=function(a,b){localStorage.setItem(a,angular.toJson(b))},a.getItem=function(a){var b=localStorage.getItem(a);return angular.fromJson(b)},a.deleteItem=function(a){localStorage.removeItem(a)},a.clear=function(){localStorage.clear()},a}]);var maziiServ=angular.module("mazii.service.note",[]);maziiServ.factory("noteServ",["$rootScope","$q","$http","$timeout","$stateParams","$state",function(a,b,c,d,e,f){function g(){if(null!=o)return o;var a=localStorage.getItem("categoryNote");return o=JSON.parse(a),null==o&&(o=[]),o}function h(){if(null!=p)return p;var a=localStorage.getItem("grammar");return p=JSON.parse(a),null==p&&(p=[]),p}function i(){if(null!=n)return n;var a=localStorage.getItem("note");return n=JSON.parse(a),null==n&&(n=[]),n}function j(){var a=JSON.stringify(n);localStorage.setItem("note",a)}function k(){var a=JSON.stringify(o);localStorage.setItem("categoryNote",a)}function l(){var a=JSON.stringify(p);localStorage.setItem("grammar",a)}var m={},n=null,o=null,p=null;return m.getNoteItem=function(a){var b=[];null==n&&i();for(var c=0;c<n.length;c++)n[c].category==a&&b.push(n[c]);null==p&&h();for(var c=0;c<p.length;c++)p[c].category==a&&b.push(p[c]);return b},m.getCategory=function(){return null==o&&g(),o},m.pushCategory=function(a){if(null!=a&&""!=a){null==o&&g();for(var b=-1,c=0;c<o.length;c++)if(o[c].category==a){b=c;break}-1!=b&&o.splice(b,1);var d=0;0!=o.length&&(d=o[o.length-1].id+1);var e={};e.category=a,e.date=new Date,o.push(e),k()}},m.pushGrammar=function(a,b,c,d){if(null!=a&&""!=a&&null!=b&&""!=b){null==p&&h();var e=-1;if(p.length>0)for(var f=0;f<p.length;f++)if(p[f].category==a&&p[f].idx==d){e=f;break}-1!=e&&p.splice(e,1);var g=0;0!=p.length&&(g=p[p.length-1].id+1);var i={};i.category=a,i.date=new Date,i.query=b,i.type=c,i.idx=d,i.id=g,p.push(i),l()}},m.pushNote=function(a,b,c){if(null!=a&&""!=a&&null!=b&&""!=b){null==n&&i();var d=-1;if(n.length>0)for(var e=0;e<n.length;e++)if(n[e].category==a&&n[e].query==b&&n[e].type==c){d=e;break}-1!=d&&n.splice(d,1);var f=0;0!=n.length&&(f=n[n.length-1].id+1);var g={};g.category=a,g.date=new Date,g.query=b,g.type=c,g.id=f,n.push(g),j()}},m.removeGrammar=function(b){for(var c=-1,d="",e=0;e<p.length;e++)if(p[e].id==b){c=e,d=p[e].category;break}-1!=c&&p.splice(c,1),l(),a.$broadcast("getNoteItem",{cate:d})},m.removeCategory=function(b){for(var c=n.length;c--;)n[c].category==b&&n.splice(c,1);for(c=p.length;c--;)p[c].category==b&&p.splice(c,1);c=-1;for(var d=0;d<o.length;d++)if(o[d].category==b){c=d;break}-1!=c&&o.splice(c,1),k(),j(),l(),a.$broadcast("getNoteItem",{cate:""})},m.removeNote=function(b){for(var c=-1,d="",e=0;e<n.length;e++)if(n[e].id==b){c=e,d=n[e].category;break}-1!=c&&n.splice(c,1),j(),a.$broadcast("getNoteItem",{cate:d})},m.clearNote=function(){n=[],j()},m.clearGrammar=function(){p=[],l()},m.clearCategory=function(){o=[],k()},m}]);var maziiServ=angular.module("mazii.service.history",[]);maziiServ.factory("historyServ",["$rootScope","$q","$http","$timeout","$stateParams","$state",function(a,b,c,d,e,f){function g(){if(null!=j)return j;var a=localStorage.getItem("history");return j=JSON.parse(a),null==j&&(j=[]),j}function h(){var a=JSON.stringify(j);localStorage.setItem("history",a)}var i={},j=null;return i.get=function(){return null==j&&g(),j},i.push=function(a,b){if(null!=a&&""!=a){null==j&&g();for(var c=-1,d=0;d<j.length;d++)if(j[d].query==a&&j[d].type==b){c=d;break}-1!=c&&j.splice(c,1);var e=0;0!=j.length&&(e=j[j.length-1].id+1);var f={};f.date=new Date,f.query=a,f.type=b,f.id=e,j.push(f),h()}},i.remove=function(a){for(var b=-1,c=0;c<j.length;c++)if(j[c].id==a){b=c;break}-1!=b&&j.splice(b,1),h()},i.clear=function(){j=[],h()},i}]);var SERVER_ERROR_CODE=302,SERVER_SUCCESS_CODE=200,baseUrl="http://mazii.net/",maziiServ=angular.module("mazii.service.search",[]);maziiServ.factory("maziiServ",["$rootScope","$q","$http","$timeout","$stateParams","$state",function(a,b,c,d,e,f){var g=baseUrl+"api/search/",h=baseUrl+"api/refer/",i=baseUrl+"api/smile/",j=baseUrl+"api/mazii/",k=baseUrl+"api/grammar/",l=baseUrl+"api/news/",m=baseUrl+"api/news/",n=baseUrl+"api/gsearch/",o=baseUrl+"api/jlptgrammar/",p=baseUrl+"api/jlptkanji/",q={},r={};return r.search=function(a,d){var e="";"word"==a?e=g+d+"/10/1":"example"==a?e=i+d:"kanji"==a?e=j+d+"/10":"grammar"==a?e=h+d:"grammar_detail"==a&&(e=k+d);var f=b.defer();return null!=q[e]?(f.resolve(q[e]),f.promise):(c.get(e).success(function(a,b,c,d){q[e]=a,f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise)},r.googleTranslate=function(a,d,e){var f=n+a+"/"+d+"/"+e,g=b.defer();return null!=q[f]?(g.resolve(q[f]),g.promise):(c.get(f).success(function(a,b,c,d){if(null!=a&&a.status==SERVER_SUCCESS_CODE){var e=JSON.parse(a.data);null!=e?(q[f]=e,g.resolve(e)):g.resolve(null)}else g.resolve(null)}).error(function(a,b,c,d){g.reject(null)}),g.promise)},r.getHeadNews=function(a){null==a&&(a=1);var d=b.defer(),e=l+a+"/10";return null!=q[e]?(d.resolve(q[e]),d.promise):(c.get(e).success(function(a,b,c,f){q[e]=a.results,d.resolve(a.results)}).error(function(a,b,c,e){d.reject(null)}),d.promise)},r.getDetailNews=function(a){var d=m+a,e=b.defer();return null!=q[d]?(e.resolve(q[d]),e.promise):(c.get(d).success(function(a,b,c,f){q[d]=a.result,e.resolve(a.result)}).error(function(a,b,c,d){e.reject(null)}),e.promise)},r.queryGrammarJLPT=function(a,d){var e=o+a+"/30/"+d,f=b.defer();return null!=q[e]?(f.resolve(q[e]),f.promise):(c.get(e).success(function(a,b,c,d){a.status==SERVER_ERROR_CODE?f.resolve(null):(q[e]=a,f.resolve(a))}).error(function(a,b,c,d){f.reject(null)}),f.promise)},r.queryKanjiJLPT=function(a,d){var e=p+a+"/100/"+d,f=b.defer();return null!=q[e]?(f.resolve(q[e]),f.promise):(c.get(e).success(function(a,b,c,d){a.status==SERVER_ERROR_CODE?f.resolve(null):(q[e]=a,f.resolve(a))}).error(function(a,b,c,d){f.reject(null)}),f.promise)},r}]);var dictUtilServices=angular.module("mazii.service.util",["mazii.service.localstore"]);dictUtilServices.factory("dictUtilSer",["$q","$http","$timeout","$state","localstoreServ",function(a,b,c,d,e){function f(){null==r&&$.ajax({type:"GET",url:o,success:function(a,b,c){var d=null;d="string"==typeof a?JSON.parse(a):a;for(var e={},f=0;f<d.length;f++)e[d[f].w]=d[f].h;r=e,1==u&&g()},error:function(a,b,c){console.log("File not found: "+o)}})}function g(){null==s&&$.ajax({type:"GET",url:p,success:function(a,b,c){s=a,h()},error:function(a,b,c){console.log("File not found: "+p)}})}function h(){null==t&&$.ajax({type:"GET",url:q,success:function(a,b,c){t=a},error:function(a,b,c){console.log("File not found: "+q)}})}function i(a){var b=a.split(",")[0];return b.split(";")[0]}var l={},m=new Array("à","á","ạ","ả","ã","â","ầ","ấ","ậ","ẩ","ẫ","ă","ằ","ắ","ặ","ẳ","ẵ","è","é","ẹ","ẻ","ẽ","ê","ề","ế","ệ","ể","ễ","ì","í","ị","ỉ","ĩ","ò","ó","ọ","ỏ","õ","ô","ồ","ố","ộ","ổ","ỗ","ơ","ờ","ớ","ợ","ở","ỡ","ù","ú","ụ","ủ","ũ","ư","ừ","ứ","ự","ử","ữ","ỳ","ý","ỵ","ỷ","ỹ","đ","À","Á","Ạ","Ả","Ã","Â","Ầ","Ấ","Ậ","Ẩ","Ẫ","Ă","Ằ","Ắ","Ặ","Ẳ","Ẵ","È","É","Ẹ","Ẻ","Ẽ","Ê","Ề","Ế","Ệ","Ể","Ễ","Ì","Í","Ị","Ỉ","Ĩ","Ò","Ó","Ọ","Ỏ","Õ","Ô","Ồ","Ố","Ộ","Ổ","Ỗ","Ơ","Ờ","Ớ","Ợ","Ở","Ỡ","Ù","Ú","Ụ","Ủ","Ũ","Ư","Ừ","Ứ","Ự","Ử","Ữ","Ỳ","Ý","Ỵ","Ỷ","Ỹ","Đ"),n={abbr:"từ viết tắt",adj:"tính từ","adj-na":"tính từ đuôi な","adj-no":"danh từ sở hữu cách thêm の","adj-pn":"tính từ đứng trước danh từ","adj-s":"tínhh từ đặc biệt","adj-t":"tính từ đuổi tara",adv:"trạng từ","adv-n":"danh từ làm phó từ","adv-to":"trạng từ thêm と",arch:"từ cổ",ateji:"ký tự thay thế",aux:"trợ từ","aux-v":"trợ động từ","aux-adj":"tính từ phụ trợ",Buddh:"thuật ngữ phật giáo",chn:"ngôn ngữ trẻ em",col:"thân mật ngữ",comp:"thuật ngữ tin học",conj:"liên từ",derog:"xúc phạm ngữ",ek:"hán tự đặc trưng",exp:"cụm từ",fam:"từ ngữ thân thuộc",fem:"phụ nữ hay dùng",food:"thuật ngữ thực phẩm",geom:"thuật ngữ hình học",gikun:"gikun",gram:"thuộc về ngữ pháp",hon:"tôn kính ngữ",hum:"khiêm nhường ngữ",id:"thành ngữ","int":"thán từ",iK:"từ chứa kanji bất quy tắc",ik:"từ chứa kana bất quy tắc",io:"okurigana bất quy tắc",iv:"động từ bất quy tắc",kyb:"giọng Kyoto",ksb:"giọng Kansai",ktb:"giọng Kantou",ling:"thuật ngữ ngôn ngữ học",MA:"thuật ngữ nghệ thuật",male:"tiếng lóng của nam giới",math:"thuật ngữ toán học",mil:"thuật ngữ quân sự","m-sl":"thuật ngữ truyện tranh",n:"danh từ","n-adv":"danh từ làm phó từ","n-pref":"danh từ làm tiền tố","n-suf":"danh từ làm hậu tố","n-t":"danh từ chỉ thời gian",neg:"thể phủ định","neg-v":"động từ mang nghĩa phủ định",ng:"từ trung tính",obs:"từ cổ",obsc:"từ tối nghĩa",oK:"từ chứa kanji cổ",ok:"từ chứa kana cổ",osk:"Giọng Osaka",physics:"thuật ngữ vật lý",pol:"thể lịch sự",pref:"tiếp đầu ngữ",prt:"giới từ",qv:"tham khảo mục khác",rare:"từ hiếm gặp",sl:"tiếng lóng",suf:"hậu tố",tsb:"giọng Tosa",uK:"từ sử dụng kanji đứng một mình",uk:"từ sử dụng kana đứng một mình",v:"động từ",v1:"động từ nhóm 2",v5:"động từ nhóm 1",v5aru:"động từ nhóm 1 -aru",v5b:"động từ nhóm 1 -bu",v5g:"động từ nhóm 1 -ku",v5k:"động từ nhóm 1 -ku","v5k-s":"động từ nhóm 1 -iku/yuku",v5m:"động từ nhóm 1 -mu",v5n:"động từ nhóm 1 -nu",v5r:"Động từ nhóm 1 -ru","v5r-i":"Động từ nhóm 1 bất quy tắc -ru",v5s:"động từ nhóm 1 -su",v5t:"động từ nhóm 1 -tsu",v5u:"động từ nhóm 1 -u","v5u-s":"động từ nhóm 1 -u (đặc biệt)",v5uru:"động từ nhóm 1 -uru",vi:"tự động từ",vk:"động từ kuru (đặc biệt)",vs:"danh từ hoặc giới từ làm trợ từ cho động từ suru","vs-i":"động từ bất quy tắc -suru",vt:"tha động từ",vulg:"thuật ngữ thô tục",vz:"tha động từ",X:"thuật ngữ thô tục"},o="db/kanjimini.json",p="db/javifastdict.txt",q="db/vijafastdict.txt",r=null,s=null,t=null,u=e.getItem("autocomplete");null==u&&(u=!0),l.isVietnamese=function(a){for(var b=a.length,c=0;b>c;c++)if(-1!=m.indexOf(a[c]))return!0;return!1},l.capitaliseFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},l.isJapanese=function(a){for(var b=a.length,c=0;b>c;c++)if(l.isKanji(a.charAt(c))||l.isHiragana(a.charAt(c))||l.isKatakan(a.charAt(c)))return!0;return!1},l.getKanjiChara=function(a){if(null==a)return"";for(var b="",c=a.length,d=0;c>d;d++)l.isKanji(a.charAt(d))&&-1==b.indexOf(a.charAt(d))&&(b+=a.charAt(d));return b},l.isRomanji=function(a){var b=a.charCodeAt(0);return b>=32&&126>=b?!0:!1},l.allHiragana=function(a){for(var b=a.length,c=0;b>c;c++)if(0==isHiragana(a.charAt(c)))return!1;return!0},l.isKanji=function(a){if("々"==a)return!0;var b=a.charCodeAt(0);return b>=19968&&40895>=b?!0:!1},l.isHiragana=function(a){var b=a.charCodeAt(0);return b>=12352&&12447>=b?!0:!1},l.isKatakan=function(a){var b=a.charCodeAt(0);return b>=12448&&12543>=b?!0:!1},l.mergeKanjiAndHiragana=function(a,b){if(""==a||""==b||null==a||null==b)return null;if(0==l.isJapanese(a)||0==l.isJapanese(b))return null;var c=new RegExp(" ","g");-1!=a.indexOf(" ")&&(a=a.replace(c,"")),-1!=b.indexOf(" ")&&(b=b.replace(c,"")),c=new RegExp("　","g"),-1!=a.indexOf("　")&&(a=a.replace(c,"")),-1!=b.indexOf("　")&&(b=b.replace(c,""));for(var d=[],e="",f="",g="",h=0,i=0;i<a.length;i++){var j=a.charAt(i);if(l.isKanji(j)||l.isKatakan(j)){if(""==e&&""!=f){var k=new Object;k.k=f,k.h="",d.push(k),f="",h+=f.length}e+=j}else if(""==e)f+=j,h++;else{for(g=j;h<b.length;){if(l.getLengthHiragana(f)<e.length||b.charAt(h)!=g)f+=b.charAt(h);else if(b.charAt(h)==g){var k=new Object;k.k=e,k.h=f,d.push(k),e="",f=j,h++;break}h++}if(h==b.length&&""!=e){var k=new Object;k.k=e,k.h=f,d.push(k)}if(h==b.length&&i<a.length-1)return null}}if(""!=e){for(;h<b.length;)f+=b.charAt(h),h++;var k=new Object;k.k=e,k.h=f,d.push(k)}else if(""!=f){var k=new Object;k.k=f,k.h="",d.push(k)}return d},l.getLengthHiragana=function(a){if(null==a||0==a.length)return 0;for(var b=0,c=0;c<a.length;c++){var d=a.charAt(c);"ん"!=d&&"ぁ"!=d&&"ぃ"!=d&&"ぇ"!=d&&"ぅ"!=d&&"ぉ"!=d&&"ゅ"!=d&&"ょ"!=d&&b++}return b},l.removeJapaneseChar=function(a){if(null==a)return"";for(var b="",c=0;c<a.length;c++)l.isJapanese(a[c])||"～"==a[c]||"、"==a[c]||"　"==a[c]||":"==a[c]||"："==a[c]||"（"==a[c]||"。"==a[c]||"）"==a[c]||(b+=a[c]);return b=b.trim()};var v={vs:["する","した","しない","し","して","できる","される","させる","すれば","しろ","しよう"],vk:["くる","きた","きない","き","きて","来られる","来られる","来させる","くれば","こい","こよう"],v5u:["う","った","わない","い","って","える","われる","わせる","えば","え","おう"],"v5u-s":["う","うた","わない","い","うて","える","われる","わせる","えば","え","おう"],v5k:["く","いた","かない","き","いて","ける","かれる","かせる","けば","け","こう"],"v5k-s":["く","った","かない","き","って","ける","かれる","かせる","けば","け","こう"],v5g:["ぐ","いだ","がない","ぎ","いで","げる","がれる","がせる","げば","げ","ごう"],v5s:["す","した","さない","し","して","せる","される","させる","せば","せ","そう"],v5t:["つ","った","たない","ち","って","てる","たれる","たせる","てば","て","とう"],v5n:["ぬ","んだ","なない","に","んで","ねる","なれる","なせる","ねば","ね","のう"],v5b:["ぶ","んだ","ばない","び","んで","べる","ばれる","ばせる","べば","べ","ぼう"],v5m:["む","んだ","まない","み","んで","める","まれる","ませる","めば","め","もう"],v5r:["る","った","らない","り","って","れる","られる","らせる","れば","れ","ろう"],"v5r-i":["る","った","","り","って","ありえる","","らせる","れば","れる","ろう"],v5aru:["る","った","らない","い","って","りえる","","","","い",""],v1:["る","た","ない","-","て","られる","られる","させる","れば","いろ","よう"]};return l.getConjugationTableOfVerb=function(a,b,c){-1!=b.indexOf("「")&&(b=b.replace("「",""),b=b.replace("」",""));var d=v[c];if(null==d)return null;b=b.split(" ")[0],-1==a.indexOf(d[0])&&(a+=d[0],b+=d[0]);var e={};e.base={},e.base.word=a+"/"+b,e.base.name="Từ điển (辞書)",a==b&&(e.base.word=a);var f=new RegExp(d[0]+"$");if(e.past={},e.past.word=a.replace(f,d[1]),e.past.name="Quá khứ (た)",""!=d[2]?(e.nagative={},e.nagative.word=a.replace(f,d[2]),e.nagative.name="Phủ định (未然)"):(e.nagative={},-1!=a.indexOf("する")?e.nagative.word=a.replace("する","しない"):-1!=a.indexOf("くる")&&(e.nagative.word=a.replace("くる","こない")),e.nagative.name="Phủ định (未然)"),""!=d[3]&&(e.polite={},"-"==d[3]?e.polite.word=a.replace(f,"")+"ます":e.polite.word=a.replace(f,d[3])+"ます",e.polite.name="Lịch sự (丁寧)"),""!=d[4]&&(e.te={},e.te.word=a.replace(f,d[4]),e.te.name="te (て)"),""!=d[5]&&(e.potential={},e.potential.word=a.replace(f,d[5]),e.potential.name="Khả năng (可能)"),""!=d[6]&&(e.passive={},e.passive.word=a.replace(f,d[6]),e.passive.name="Thụ động (受身)"),""!=d[7]&&(e.causative={},e.causative.word=a.replace(f,d[7]),e.causative.name="Sai khiến (使役)"),""!=d[6]&&""!=d[7]){var g=v.v1,h=new RegExp(g[0]+"$");e.cau_pass={},e.cau_pass.word=e.causative.word.replace(h,d[6]),e.cau_pass.name="Sai khiến thụ động (使役受身)"}return""!=d[8]&&(e.conditional={},e.conditional.word=a.replace(f,d[8]),e.conditional.name="Điều kiện (条件)"),""!=d[9]&&(e.imperative={},e.imperative.word=a.replace(f,d[9]),e.imperative.name="Mệnh lệnh (命令)"),""!=d[10]&&(e.volitional={},e.volitional.word=a.replace(f,d[10]),e.volitional.name="Ý chí (意向)"),e.prohibition={},e.prohibition.word=a+"な",e.prohibition.name="Cấm chỉ(禁止)",e},l.convertKindToReadable=function(a){var b=[];if(-1!=a.indexOf(",")){b=a.split(",");for(var c=0;c<b.length;c++)b[c]=b[c].trim()}else b.push(a);for(var d="",c=0;c<b.length;c++)d+=n.hasOwnProperty(b[c])?n[b[c]]:b[c],c!=b.length-1&&(d+=", ");return d},l.getHVOfKey=function(a){if(null==a||a.length>=5)return"";if(null==r)return"";for(var b="",c=0;c<a.length;c++)if(l.isKanji(a[c])){var d=r[a[c]];null!=d&&(""!=b&&(b+=" "),b+=i(d))}return b},l.sortHVDataByKeyWord=function(a,b){for(var c=new Array,d=0,e=0;e<a.length;e++)for(j=0;j<b.length;j++)if(a[e]==b[j].kanji){var f=!1;for(k=0;k<c.length;k++)if(c[k].kanji==a[e]){f=!0;break}0==f&&(c[d]=b[j],d++)}return c},l.realtimeSearch=function(a,b){var c=s,d=!0;"vi"==a&&(c=t,d=!1);var e=null,f=b.length,g=new RegExp('"([^"]*'+b+'[^"]*)"',"gi"),h=0,i=[],j=4;for(f>4?j=16:f>6&&(j=20);e=g.exec(c);){var k=e[1],l="";if(d){for(var m=k.split(" "),l=m[0],n=0;n<m.length&&-1==l.indexOf(b);)n++,l=m[n];if(l.length-f>j)continue}else if(l=k,l.length-f>j)continue;if(l==b?i.splice(0,0,k):i.push(k),h+=1,h>=150)break}for(var o=[],h=0;30>h&&h<i.length;h++)o.push(i[h]);return o},l.sortResultSuggest=function(a,b){if(null==a)return null;for(var c=a.length,d=0;c>d;d++)for(var e=d+1;c>e;e++);},l.convertStrToInt=function(a){if(null==a)return 0;for(var b=0,c=a.length-1,d=1;c>=0;)b+=a.charCodeAt(c)*d,c--,d*=10;return b},l.generateSuggest=function(a,b){if(null==a||0==a.length)return"";for(var c='<div class="item suggest" ng-click="suggestClick({{item}})"><span><b>{{ item.split(" ")[0] }}</b> {{ item.replace(item.split(" ")[0], "") }} </span></div>',d='<div class="list">',e={item:"",suggestClick:b},f=0;f<a.length;f++)e.item=a[f],d+=$interpolate(c)(e);return d+="</div>"},l.closePanel=function(){$(".menu-left").removeClass("open-menu-left"),$(".history-panel").removeClass("open-history-panel"),$(".setting-panel").removeClass("open-setting-panel"),$(".cover").css("display","none"),$("body").css("overflow","auto")},l.showTitlePage=function(){$(".title-page").removeClass("hidden-title")},l.hiddenTitlePage=function(){$(".title-page").addClass("hidden-title")},l.checkExistNewlineinMessage=function(a){return a.content.indexOf("\n")},l.renderHtmlMessage=function(a){return a.content.split("\n")},l.renderHtmlMessagePrivate=function(a){return a.message.split("\n")},l.renderHtmlListMessage=function(a){for(var b=a.length,c=0;b>c;c++){var d=l.renderHtmlMessage(a[c]);d.length>1&&(a[c].newLine=!0,a.content=d)}return a},f(),l}]);var authServ=angular.module("mazii.service.auth",[]);authServ.factory("authServ",["$rootScope","$q","$http","$timeout","$stateParams","$state",function(a,b,c,d,e,f){function g(){var a=b.defer();return FB.api("/me",function(b){var c=b.email;("undefined"==typeof c||null==c||""==c)&&(b.email=b.id+"@gmail.com"),a.resolve(b)}),a.promise}var h={};return h.loginFacebook=function(){var a=b.defer();return FB.login(function(b){"connected"===b.status?g().then(function(b){a.resolve(b)}):a.resolve(null)}),a.promise},h.logoutFacebook=function(){FB.logout()},h.init=function(){FB.getLoginStatus(function(b){"connected"===b.status?g().then(function(b){var c=b.email;(null==c||""==c)&&(b.email=b.id+"@gmail.com"),a.user=b,a.$broadcast("loadFBDone")}):a.$broadcast("loadFBDone")})},h}]);var initSearchCtrl=!1,SERVER_ADRESS="http://crazyjapanese.com:8989",SHOW_NOTIFY_NEW_VERSION=!0;angular.module("mazii",["ui.router","mazii.service.history","mazii.service.note","mazii.service.util","mazii.service.search","mazii.service.auth","ngAudio","ngSanitize","templates-main"]).config(["$stateProvider","$urlRouterProvider","$sceProvider",function(a,b,c){b.otherwise("search"),b.when("/search?type&query",["$match","$stateParams",function(a,b){return initSearchCtrl?!0:!1}]),a.state("/",{url:"/","abstract":!0}).state("search",{url:"/search?type&query",views:{main:{templateUrl:"views/search/main.html",controller:"SearchController"},right:{templateUrl:"views/search/right.html"}}}).state("news",{url:"/news",views:{main:{templateUrl:"views/news/main.html",controller:"NewsController"},right:{templateUrl:"views/news/right.html"}}}).state("jlpt",{url:"/jlpt",views:{main:{templateUrl:"views/jlpt/main.html",controller:"JLPTController"},right:{templateUrl:"views/jlpt/right.html"}}}).state("note",{url:"/note",views:{main:{templateUrl:"views/note/main.html",controller:"NoteController"},right:{templateUrl:"views/note/right.html"}}}).state("write",{url:"/write",views:{main:{templateUrl:"views/write/main.html",controller:"WriteController"},right:{templateUrl:"views/write/right.html"}}}).state("help",{url:"/help",views:{main:{templateUrl:"views/help/main.html",controller:"HelpController"}}}).state("about",{url:"/about",views:{main:{templateUrl:"views/about/main.html",controller:"AboutController"}}}).state("chat",{url:"/chat",views:{main:{templateUrl:"views/chat/main.html",controller:"ChatController"}}}).state("term",{url:"/term",views:{main:{templateUrl:"views/term/main.html",controller:"TermController"}}}),c.enabled(!1)}]).run(["$rootScope","$state","$timeout","maziiServ","dictUtilSer","historyServ","$stateParams","$location","authServ",function(a,b,c,d,e,f,g,h,i){function j(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?!0:!1}function k(){j()?($("#chat-module").html(""),$("#chat-module").addClass("removed")):$("#chat-module").removeClass("removed"),$(".chat-box-control .suggest-chat-close").click(function(a){$("#chat-module").html(""),$("#chat-module").addClass("removed")}),$(".chat-title").click(function(a){$("#chat-module").removeClass("hide-chat")}),$(".chat-close").click(function(a){$("#chat-module").addClass("hide-chat")})}window.fbAsyncInit=function(){FB.init({appId:"1428630557429556",xfbml:!0,version:"v2.5"}),i.init()},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk"),a.getState=function(a){return b.current.name==a?"active":""},a.$on("$stateChangeSuccess",function(b,c,d,e,f){"search"==e.name&&(initSearchCtrl=!1),"search"!==c.name?a.enableInstantView=!0:a.enableInstantView=!1,l()}),a.noResults=!1,a.examples=null,a.words=null,a.kanjis=null,a.grammars=null,a.tabSelected=0,a.showLoading=!1,a.currentKanjiSelected=0,a.showKanjiDraw=!1,a.showKanjiDrawTable=function(){a.showKanjiDraw=!a.showKanjiDraw},a.$on("query",function(c,d){null!=d&&("search"!=b.current.name||"word"!=d.type&&"kanji"!=d.type&&"grammar"!=d.type)&&(null==d.query?a.startQuery(d,!0):(a.setTabByChar(d.type[0]),"grammarDetail"!=d.type?a.startQuery(d.query,!0):a.queryGrammarDetail(d.query)),$("#instant-search").modal())}),a.lang="JA",a.changeLang=function(){"JA"==a.lang?a.lang="VI":a.lang="JA"},a.queryGrammarDetail=function(b){a.noResults=!1,a.examples=null,a.words=null,a.kanjis=null,a.grammars=null,a.grammarDetail=null,a.suggest=null,a.googleTranslate=null,d.search("grammar_detail",b).then(function(b){a.titleInstantSearch="Tra nhanh ngữ pháp: ",a.grammarDetail=b,a.noResults=!1})},a.startQuery=function(b){a.noResults=!1,a.examples=null,a.words=null,a.kanjis=null,a.grammars=null,a.grammarDetail=null,a.suggest=null,a.googleTranslate=null;var c=!1;if(0==e.isJapanese(b)&&(e.isVietnamese(b)||null!=forceVietnamese?(b=b.toLowerCase(),c=!0):(b[0]==b[0].toUpperCase()&&b[1]==b[1].toLowerCase()&&(b=b.toLowerCase()),b=wanakana.toKana(b))),0==a.tabSelected){a.titleInstantSearch="Tra nhanh từ vựng: "+b,f.push(b,"word",c?"VI":"JA");var g="javi";c&&(g="vija"),d.search("word",b).then(function(e){var f="ja",g="vi";if(c?(f="vi",g="ja"):(f="ja",g="vi"),200==e.status){if(0==e.found)a.suggest=e.data;else{"JA"!=a.lang?(f="vi",g="ja"):(f="ja",g="vi"),a.words=[],a.suggest=[];for(var h=0;h<e.data.length;h++)e.data[h].word==b?a.words.push(e.data[h]):a.suggest.push(e.data[h])}a.showLoading=!1}else a.words=null,a.showLoading=!1,"JA"!=a.lang?(f="vi",g="ja"):(f="ja",g="vi");d.googleTranslate(b,f,g).then(function(b){a.googleTranslate=b,null==a.$$phase&&a.$apply()})},function(b){a.words=null,a.showLoading=!1,a.noResults=!0})}else 1==a.tabSelected?(a.titleInstantSearch="Tra nhanh hán tự: "+b,d.search("kanji",b).then(function(c){if(a.currentKanjiSelected=0,200==c.status){var d=e.getKanjiChara(b);a.kanjis=e.sortHVDataByKeyWord(d,c.results),a.showLoading=!1,f.push(b,"kanji")}else a.kanjis=null,a.showLoading=!1,a.noResults=!0},function(b){a.kanjis=null,a.showLoading=!1,a.noResults=!0})):3==a.tabSelected?(a.titleInstantSearch="Tra nhanh ngữ pháp: "+b,d.search("grammar",b).then(function(c){200==c.status?(a.grammars=c.results,a.showLoading=!1,f.push(b,"grammar")):(a.grammars=null,a.showLoading=!1,a.noResults=!0)},function(b){a.grammars=null,a.showLoading=!1,a.noResults=!0})):2==a.tabSelected&&d.search("example",b).then(function(c){200==c.status?(a.examples=c.results,a.showLoading=!1,f.push(b,"example")):(a.examples=null,a.showLoading=!1,a.noResults=!0)},function(b){a.examples=null,a.showLoading=!1,a.noResults=!0})},a.changeKanjiShow=function(b){a.currentKanjiSelected=b},a.getCurrentKanji=function(){return a.kanjis[a.currentKanjiSelected]},a.kanjiSeletectClass=function(b){return a.currentKanjiSelected==b?"selected":""},a.getCurrentType=function(){switch(a.tabSelected){case 0:return"w";case 1:return"k";case 2:return"s";case 3:return"g"}return"w"},a.setTabByChar=function(b){null==b||""==b?a.tabSelected=0:"w"==b?a.tabSelected=0:"k"==b?a.tabSelected=1:"e"==b?a.tabSelected=2:"g"==b?a.tabSelected=3:"s"==b&&(a.tabSelected=2)},a.report={},a.alert={},a.report.send=function(b){if(null==b||""==b)a.report.noComment=!0;else{(null==a.report.id||null==a.report.type)&&($("#reportModal").modal("hide"),a.showAlert("Báo lỗi không thành công, bạn hãy thử lại."));var c=Parse.Object.extend("ReportWrong"),d=new c;d.save({entryId:a.report.id,type:a.report.type,comment:a.report.comment,entry:a.report.entry},{success:function(b){$("#reportModal").modal("hide"),a.showAlert("Cảm ơn bạn. Chúng tôi sẽ xem xét và sửa lại nội dung này.")},error:function(b,c){$("#reportModal").modal("hide"),a.showAlert("Báo lỗi không thành công, bạn hãy thử lại.")}})}},a.showAlert=function(b){a.alert.message=b,$("#alertModal").modal()};var l=function(){var a=b.current.name,c="",d="",e="";"search"==a||"write"==a||"term"==a?(c="col-md-12 col-xs-12",d="col-md-3 col-lg-3",e="col-md-3 col-lg-3"):"news"==a?(c="col-md-8 col-lg-8",d="col-md-4 col-lg-4",e=""):"note"==a?(c="col-md-6 col-lg-6",d="col-md-6 col-lg-6",e="col-md-3 col-lg-3"):"help"==a||"about"==a?(c="col-md-12 col-lg-12",d="",e=""):"jlpt"==a?(c="col-md-12 col-xs-12",d="col-md-3 col-lg-3",e="col-md-3 col-lg-3"):"chat"==a?(c="col-md-12 col-xs-12",d="col-md-3 col-lg-3",e="col-md-3 col-lg-3"):(c="col-md-6 col-lg-6",d="col-md-3 col-lg-3",e="col-md-3 col-lg-3"),$("#view1").attr("class",c),$("#view2").attr("class",d),$("#view3").attr("class",e),console.log("set layout")};a.$on("$stateChangeSuccess",function(b,c,d,f,g){"search"==c.name?a.showButtonHistory=!0:a.showButtonHistory=!1;var h=$('.menu-left li a[href="#'+c.name+'"]');$(".menu-left li").removeClass("menu-left-active"),h.parent().addClass("menu-left-active"),e.closePanel()}),k(),Parse.initialize("GnmiBlYGB7SXRQZjRTYrWFx2LgXccdjaTiRtDIos","gcTf8iCxURq0XTuwvrLmKUKYbrHelJphX8b3dm4E")}]).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}).directive("focusMe",["$timeout",function(a){return{link:function(b,c,d){a(function(){c[0].focus()},500)}}}]),angular.module("mazii").directive("ngExample",function(){return{restrict:"E",templateUrl:"components/example/example-template.html",scope:{data:"=data",index:"@"},controller:["$rootScope","$scope","$http","dictUtilSer",function(a,b,c,d){d.isJapanese(b.data.mean)?(b.isJapanese=!1,b.mergeExample=d.mergeKanjiAndHiragana(b.data.mean,b.data.transcription)):(b.isJapanese=!0,b.mergeExample=d.mergeKanjiAndHiragana(b.data.content,b.data.transcription))}]}}),angular.module("mazii").directive("ngKanji",function(){return{restrict:"E",templateUrl:"components/kanji/kanji-template.html",scope:{data:"=data"},controller:["$rootScope","$scope","$http","dictUtilSer",function(a,b,c,d){b.collapse=!1,null!=b.data&&null!=b.data.detail&&(b.details=b.data.detail.split("##")),console.log(b.details),b.getDetails=function(){return b.details=b.data.detail.split("##"),console.log(b.details),b.details},b.getTitle=function(){b.title="";for(var a=b.data.detail.split("##"),c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.length;e++)if("."==d[e]){b.title+=d.substr(0,e+1)+" ";break}return b.title},b.search=function(b){a.$broadcast("searchKanji",b)},b.showCollapse=function(){1==b.collapse?$(".list-collapse").slideUp(100):$(".list-collapse").slideDown(100),b.collapse=!b.collapse},b.setQueryType=function(b,c){a.$broadcast("setQueryType",{query:b,type:c})}}]}}),angular.module("mazii").directive("ngGrammar",function(){return{restrict:"E",templateUrl:"components/grammar/grammar-template.html",scope:{data:"=data",detail:"=detail"},controller:["$rootScope","$scope","$http","dictUtilSer","maziiServ",function(a,b,c,d,e){if(b.loadDetail=function(){null==b.detail&&e.search("grammar_detail",b.data._id).then(function(a){b.detail=a.grammar})},b.splitUtil=function(a,b){if(null==a||""==a)return null;for(var c=a.split(b),d=[],e=0;e<c.length;e++){var f=c[e].trim();""!=f&&d.push(f)}return d},b.removeJapaneseChar=function(a){return d.removeJapaneseChar(a)},b.splitExplain=function(a){return b.splitUtil(a,"☞")},b.splitNote=function(a){return b.splitUtil(a,"☞")},b.setQueryGrammar=function(b,c,d){a.$broadcast("setQueryGrammar",{query:b,type:c,id:d})},b.$watch("data",function(a,c){return null!=b.data.grammar?(b.showDetailImediately=!0,void(b.detail=b.data.grammar)):void(b.showDetailImediately=!1)}),null!=b.data.grammar)return b.showDetailImediately=!0,void(b.detail=b.data.grammar);b.showDetailImediately=!1;var f=b.data.title.split("=>"),g="";f.length>1&&(g=f[1]),b.title=f[0],b.titleMean=g,b.id=b.data._id.replace(/:/g,"_")}]}}),angular.module("mazii").directive("ngKanjiResultSearchWord",function(){return{restrict:"E",templateUrl:"components/kanji-result-search-word/kanji-result-search-word-template.html",scope:{data:"=data"},controller:["$rootScope","$scope","$http","dictUtilSer",function(a,b,c,d){b.collapse=!1,null!=b.data&&null!=b.data.detail&&(b.details=b.data.detail.split("##")),b.getTitle=function(){b.title="";for(var a=b.data.detail.split("##"),c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.length;e++)if("."==d[e]){b.title+=d.substr(0,e+1)+" ";break}return b.title},b.search=function(b){a.$broadcast("searchKanji",b)},b.viewDetail=function(b){a.$broadcast("searchKanji",b)}}]}}),angular.module("mazii").directive("ngWord",function(){return{restrict:"E",templateUrl:"components/word/word-template.html",scope:{data:"=data"},controller:["$rootScope","$scope","$http","dictUtilSer","ngAudio",function(a,b,c,d,e){var f="http://www.ispeech.org/p/generic/getaudio?text=",g="&voice=jpjapanesemale&speed=0&action=convert";b.id=1e3*Math.random();for(var h=b.data,i=0;i<h.means.length;i++){var j=h.means[i].kind;if(null!=j&&""!=j){var k=[];if(-1!=j.indexOf(",")){k=j.split(",");for(var l=0;l<k.length;l++)k[l]=k[l].trim()}else k.push(j);for(var l=0;l<k.length;l++){var m=d.getConjugationTableOfVerb(h.word,h.phonetic,k[l]);if(null!=m){b.conjugationVerb=m;break}}}if(null!=b.conjugationVerb)break}b.setQueryType=function(b,c){a.$broadcast("setQueryType",{query:b,type:c})};var n=f+b.data.phonetic+g;b.sound=e.load(n),b.playAudio=function(){b.sound.play()};var o=b.data.word;d.isJapanese(o)&&(b.amHanViet=d.getHVOfKey(o)),b.data.kinds={},b.data.noKinds=[];for(var i=0;i<b.data.means.length;i++){var p=b.data.means[i];null!=p.kind&&""!=p.kind?(null==b.data.kinds[p.kind]&&(b.data.kinds[p.kind]=[]),b.data.kinds[p.kind].push(p)):b.data.noKinds.push(p)}b.convertKindToReadable=function(a){return null==a||""==a?"":d.convertKindToReadable(a)},b.capitaliseFirstLetter=function(a){return d.capitaliseFirstLetter(a)},b.showVerbConjugtion=function(){}}]}}),angular.module("mazii").directive("ngSetting",function(){return{restrict:"E",templateUrl:"components/setting/setting-template.html",controller:["$rootScope","$scope","$http","localstoreServ","$state",function(a,b,c,d,e){b.furigana=d.getItem("showFurigana"),b.suggest=d.getItem("showSuggest"),b.showFurigana=function(){d.setItem("showFurigana",b.furigana),b.$emit("changeShowFurigana",b.furigana)},b.showSuggestSearch=function(){d.setItem("showSuggest",b.suggest),b.$emit("chaneShowSuggest",b.suggest)}}]}}),angular.module("mazii").directive("ngKanjiRecognize",function(){return{restrict:"E",templateUrl:"components/kanji-recognize/kanji-recognize-template.html",controller:["$rootScope","$scope","$http","dictUtilSer",function(a,b,c,d){setTimeout(function(){new KanjiWriter({canvasId:"draw-canvas",colorDraw:"black",lineWidthDraw:4,resultId:"#draw-kanji-result",clearButtonId:"#draw-clear",backButtonId:"#draw-back",classResult:"draw-kanji-suggest",resultClickCallback:function(){var b=$(this).text();null!=b&&""!=b&&($("#draw-clear").trigger("click"),a.$broadcast("insertQueryText",b))}})},100)}]}}),angular.module("mazii").directive("ngKanjiDraw",function(){return{restrict:"E",templateUrl:"components/kanji-draw/kanji-draw-template.html",
scope:{data:"=data"},controller:["$rootScope","$scope","$http","dictUtilSer",function(a,b,c,d){function e(){var a={skipLoad:!1,autoplay:!0,height:250,width:250,viewBox:{x:0,y:0,w:125,h:125},step:.01,stroke:{animated:{drawing:!0,erasing:!0},order:{visible:!0,attr:{"font-size":"8",fill:"#33B5E5"}},attr:{active:"#CC0000",stroke:"random","stroke-width":3,"stroke-linecap":"round","stroke-linejoin":"round"}},grid:{show:!0,attr:{stroke:"#CCCCCC","stroke-width":.5,"stroke-dasharray":"--"}}};return a}b.draw=function(){$("#image-holder").dmak(b.data,e())},b.resetDrawKanjiStroke=function(){var a=$("#image-holder");a.html(""),a.data("plugin_dmak")&&(a.dmak("reset"),a.data("plugin_dmak",null)),b.draw()},b.$watch("data",function(a,c){a!=c&&b.resetDrawKanjiStroke()}),b.resetDrawKanjiStroke()}]}}),angular.module("mazii").directive("ngHistory",function(){return{restrict:"E",templateUrl:"components/history/history-template.html",controller:["$rootScope","$scope","$http","historyServ","$state","localstoreServ","dictUtilSer",function(a,b,c,d,e,f,g){b.history=d.get(),b.search=function(b,c){g.closePanel(),a.$broadcast("query",{type:b,query:c})},b.getTime=function(a){var b=new Date(a);return b.toDateString()},b.deleteHistory=function(){$("#confirmDeleteHistoryModal").modal("show")},$(".deleteHistory").click(function(){d.clear(),b.history=d.get(),$("#confirmDeleteHistoryModal").modal("hide")})}]}}),angular.module("mazii").directive("ngNote",function(){return{restrict:"E",replace:!0,templateUrl:"components/notes/note-template.html",controller:["$rootScope","$scope","$http","noteServ","$state",function(a,b,c,d,e){b.note=[],b.state=!1,d.getCategory().length>0&&(b.note=d.getNoteItem(d.getCategory()[d.getCategory().length-1].category)),b.search=function(b,c){a.$broadcast("query",{type:b,query:c})},b.deleteNote=function(a){d.removeNote(a)},b.deleteGrammar=function(a){d.removeGrammar(a)},b.getDeleteState=function(){return b.state?"":"hidden-note-delete"},b.showEditNote=function(){0==b.state?b.state=!0:b.state=!1},b.$on("getNoteItem",function(a,c){""==c.cate?b.note=[]:b.note=d.getNoteItem(c.cate)}),b.getTime=function(a){var b=new Date(a);return b.toDateString()}}]}}),angular.module("mazii").directive("ngNoteContent",function(){return{restrict:"E",replace:!0,templateUrl:"components/notes/note-content-template.html",controller:["$rootScope","$scope","$http","noteServ","$state",function(a,b,c,d,e){b.category=d.getCategory(),b.cate="",b.query="",b.type="",b.grammarID="",b.saveNoteMe=function(a){console.log("ID",b.grammarID),""!=b.grammarID?(console.log("ID",b.grammarID),d.pushGrammar(a,b.query,b.type,b.grammarID)):""!=b.query&&""!=b.type&&(console.log("Vao test",b.grammarID),d.pushNote(a,b.query,b.type)),b.cate="",b.query="",b.type="",b.grammarID="",$("#myNote").modal("hide")},b.$on("setQueryType",function(a,c){(""!=c.query||null!=c.query)&&(b.query=c.query),(""!=c.type||null!=c.type)&&(b.type=c.type)}),b.$on("setQueryGrammar",function(a,c){(""!=c.query||null!=c.query)&&(b.query=c.query),(""!=c.type||null!=c.type)&&(b.type=c.type),(""!=c.id||null!=c.id)&&(b.grammarID=c.id)}),b.getTime=function(a){var b=new Date(a);return b.toDateString()}}]}}),angular.module("mazii").directive("ngCategory",function(){return{restrict:"E",replace:!0,templateUrl:"components/notes/category-template.html",controller:["$rootScope","$scope","$http","noteServ","$state",function(a,b,c,d,e){b.nameCategory="",b.cate="",b.query="",b.type="",b.grammarID="",b.saveCategory=function(){""!=b.nameCategory&&(d.pushCategory(b.nameCategory),d.pushNote(b.nameCategory,b.query,b.type)),b.nameCategory="",b.cate="",b.query="",b.type="",$("#myCategory").modal("hide")},b.saveNoteMe=function(a){""!=b.grammarID?d.pushGrammar(a,b.query,b.type,b.grammarID):""!=b.query&&""!=b.type&&d.pushNote(a,b.query,b.type),b.cate="",b.query="",b.type="",b.grammarID="",$("#myNote").modal("hide")},b.$on("setQueryType",function(a,c){(""!=c.query||null!=c.query)&&(b.query=c.query),(""!=c.type||null!=c.type)&&(b.type=c.type)}),b.$on("setQueryGrammar",function(a,c){(""!=c.query||null!=c.query)&&(b.query=c.query),(""!=c.type||null!=c.type)&&(b.type=c.type),(""!=c.id||null!=c.id)&&(b.grammarID=c.id)}),b.$on("set",function(a,c){(""!=c.query||null!=c.query)&&(b.query=c.query),(""!=c.type||null!=c.type)&&(b.type=c.type)})}]}}),angular.module("mazii").directive("ngNewsother",function(){return{restrict:"E",templateUrl:"components/news/newsother-template.html",controller:["$rootScope","$scope","$state","$timeout","maziiServ","dictUtilSer","historyServ",function(a,b,c,d,e,f,g){b.clickID=-1,e.getHeadNews().then(function(a){b.lastestNews=a;var c=a[0].value.id;b.clickID=c,e.getDetailNews(c).then(function(a){b.currentNews=a})}),b.changeDetailNews=function(c){return b.clickID==c?!1:(b.clickID=c,$(".news-link>a").removeClass("news_active"),$(".news-link>#"+c).addClass("news_active"),a.$broadcast("changeDetailNews",{id:c}),void(-1==h.indexOf(c)&&(h.push(c),localStorage.setItem("news_read",JSON.stringify(h)))))},b.getNewsReadClass=function(a){var c;return c=b.clickID==a?"news_active":-1!=h.indexOf(a)?"news_read":""};var h=JSON.parse(localStorage.getItem("news_read"));null==h&&(h=[])}]}}),angular.module("mazii").directive("ngVerbConjugtion",function(){return{restrict:"E",scope:{data:"=data"},templateUrl:"components/verb-conjugtion/verb-conjugtion-template.html",controller:["$rootScope","$scope","$http","dictUtilSer",function(a,b,c,d){}]}}),angular.module("mazii").directive("ngGoogleTranslate",function(){return{restrict:"E",scope:{data:"=data"},templateUrl:"components/google-translate/google-translate-template.html",controller:["$rootScope","$scope","$http","dictUtilSer",function(a,b,c,d){}]}}),angular.module("mazii").directive("ngSynonyms",function(){return{restrict:"E",scope:{data:"=data"},templateUrl:"components/synonyms/synonyms-template.html",controller:["$rootScope","$scope","$http","dictUtilSer",function(a,b,c,d){b.searchThis=function(b){a.$broadcast("query",b)}}]}}),angular.module("mazii").directive("ngReport",function(){return{restrict:"E",templateUrl:"components/report/report-template.html",scope:{data:"=data",type:"@"},controller:["$rootScope","$scope","$http",function(a,b,c){b.showReportDialog=function(){var c=b.type,d="",e="";"grammar"==c?(d=b.data._id,e=b.data.title):"kanji"==c?(d=b.data._id,e=b.data.kanji):"word"==c?(d=b.data._id,e=b.data.word):"grammarDetail"==c&&(c="grammar",d=b.data._id,e=b.data.title),a.report.type=c,a.report.entry=e,a.report.id=d,a.report.comment="",$("#reportModal").modal({backdrop:"static"})}}]}}),angular.module("mazii").directive("setFocus",function(){return{scope:{setFocus:"="},link:function(a,b){a.setFocus&&(b[0].style.background="blue")}}}),angular.module("mazii").directive("ngFooter",function(){return{restrict:"E",templateUrl:"components/footer/footer-template.html"}}),angular.module("mazii").directive("ngNotify",function(){return{restrict:"E",templateUrl:"components/notify/notify-template.html"}}),angular.module("mazii").controller("SearchController",["$rootScope","$scope","$state","$timeout","maziiServ","dictUtilSer","historyServ","$stateParams","$location","localstoreServ","ngAudio",function(a,b,c,d,e,f,g,h,i,j,k){initSearchCtrl=!0,b.examples=null,b.words=null,b.kanjis=null,b.grammars=null,b.suggest=null,b.googleTranslate=null,a.title="Tìm kiếm",b.tabSelected=0,b.showLoading=!1,b.currentKanjiSelected=0,b.noResults=!1,b.showNotifynewVersion=SHOW_NOTIFY_NEW_VERSION,b.startSearch=!1;var l,m=!1,n="",o=j.getItem("showSuggest");b.showKanjiDrawTable=function(){m=!m,0==m&&(n=$("#search-text-box").val(),""!=n&&b.startQuery(n))},b.queryNotNull=function(){return null!=n&&""!=n},b.getCurrentQuery=function(){return n},b.isShowKanjiDraw=function(){return m},b.inputEnter=function(){n=$("#search-text-box").val(),""!=n&&b.startQuery(n)},b.$on("query",function(a,c){if(null!=c)if(null==c.query)n=c,b.startQuery(c,!0);else{if("grammarDetail"==c.type)return;n=c.query,b.setTabByChar(c.type[0]),b.startQuery(n,!0)}}),b.filter=function(a){if(o){var b=a.query,c=null;if(f.isJapanese(b))c=f.realtimeSearch("ja",b);else if(f.isVietnamese(b))c=f.realtimeSearch("vi",b);else{b.length>1&&b[0]==b[0].toUpperCase()&&b[1]==b[1].toLowerCase()&&(b=b.toLowerCase());var d=wanakana.toKana(b);c=f.realtimeSearch("ja",d),c.splice(0,0,b)}return c}return[]},b.$on("insertQueryText",function(a,b){if(null!=b&&""!=b){var c=$("#search-text-box").val();c+=b,$("#search-text-box").val(c)}}),b.clearQuery=function(){$("#search-text-box").val(""),n="",b.suggestSen=[],setTimeout(function(){$("#search-text-box").focus()},10)},b.changePlaceHolder=function(){var a="",c=b.tabSelected;switch(c){case 0:a="日本, nihon, Nhật Bản";break;case 1:a="公, công";break;case 2:a="優しい, yasashii, tốt bụng";break;case 3:a="のに, để"}$("#search-text-box").attr("placeholder",a)},b.getTypeButtonClass=function(a){return a==b.tabSelected?"btn-primary":"btn-default"},b.changeTypeSearch=function(a,c){if(a!=b.tabSelected){b.tabSelected=a,1==m&&(m=!1),$(".search-input-container button").removeClass("tab-active"),$("#tab"+a).addClass("tab-active");var d="";switch(a){case 0:d="日本, nihon, Nhật Bản",l="word";break;case 1:d="公, công",l="kanji";break;case 2:d="優しい, yasashii, tốt bụng",l="example";break;case 3:d="のに, để",l="grammar"}$("#search-text-box").attr("placeholder",d),1!=c&&(n=$("#search-text-box").val(),n&&""!=n&&b.startQuery(n))}};var p=null;b.enterInput=function(c){null!=c&&""!=c?(null!=p&&clearTimeout(p),c.length>1&&c[0]==c[0].toUpperCase()&&c[1]==c[1].toLowerCase()&&(c=c.toLowerCase()),p=setTimeout(function(){var d={type:l,query:c};b.suggestSen=b.filter(d),1!=b.tabSelected||f.isJapanese(c)||(b.suggestSen=[]),new s("search-text-box","list-suggest-history");var e=$(".search-box-range").width();$(".list-suggest-history").css("width",e),b.$$phase||a.$$phase||b.$digest()},400)):(b.suggestSen=[],clearTimeout(p),p=null)},b.suggestClick=function(a){f.isJapanese(a)?b.startQuery(a.split(" ")[0],!0):b.startQuery(a,!0)},b.startQuery=function(c,d){b.startSearch=!0,null!=p&&clearTimeout(p),m=!1,b.showServerContent=!1,n=c,b.noResults=!1,b.examples=null,b.words=null,b.kanjis=null,b.grammars=null,b.suggest=null,b.googleTranslate=null,b.lang="JA",b.showLoading=!0,1==b.tabSelected&&(d=!0);var h=!1;if(0==f.isJapanese(c)&&(f.isVietnamese(c)||null!=d?(c=c.toLowerCase(),h=!0,b.lang="VI"):(c.length>1&&c[0]==c[0].toUpperCase()&&c[1]==c[1].toLowerCase()&&(c=c.toLowerCase()),c=wanakana.toKana(c))),n=c,$("#search-text-box").val(n),b.query=c,0==b.tabSelected){g.push(c,"word",b.lang);var i="javi";("VI"==b.lang||h)&&(i="vija"),e.search("word",c,i).then(function(d){var g="ja",i="vi";if(null==d)return h?(g="vi",i="ja"):(g="ja",i="vi"),b.words=null,f.showLoading(!1),void e.googleTranslate(c,g,i,function(c){null==c&&(b.noResults=!0),b.googleTranslate=c,b.$$phase||a.$$phase||b.$digest()});if(200==d.status){if(0==d.found)b.suggest=d.data;else{h?(g="vi",i="ja"):(g="ja",i="vi"),b.words=[],b.suggest=[];for(var j=0;j<d.data.length;j++)d.data[j].word==c?b.words.push(d.data[j]):b.suggest.push(d.data[j])}b.showLoading=!1}else b.words=null,b.showLoading=!1,h?(g="vi",i="ja"):(g="ja",i="vi");e.googleTranslate(c,g,i).then(function(a){b.googleTranslate=a,null==b.$$phase&&b.$apply()})},function(a){b.words=null,b.showLoading=!1,b.noResults=!0}),e.search("kanji",c).then(function(a){if(200==a.status){if(f.isJapanese(c)){var d=f.getKanjiChara(c);b.resultKanjis=f.sortHVDataByKeyWord(d,a.results)}else b.resultKanjis=a.results;b.noResultsKanjis=!1}else b.resultKanjis=null,b.noResultsKanjis=!0},function(a){b.resultKanjis=null,b.noResultsKanjis=!0})}else 1==b.tabSelected?e.search("kanji",c).then(function(a){if(b.currentKanjiSelected=0,200==a.status){if(f.isJapanese(c)){var d=f.getKanjiChara(c);b.kanjis=f.sortHVDataByKeyWord(d,a.results)}else b.kanjis=a.results;b.showLoading=!1,g.push(c,"kanji",b.lang)}else b.kanjis=null,b.showLoading=!1,b.noResults=!0},function(a){b.kanjis=null,b.showLoading=!1,b.noResults=!0}):3==b.tabSelected?e.search("grammar",c).then(function(a){200==a.status?(b.grammars=a.results,b.showLoading=!1,g.push(c,"grammar",b.lang)):(b.grammars=null,b.showLoading=!1,b.noResults=!0)},function(a){b.grammars=null,b.showLoading=!1,b.noResults=!0}):2==b.tabSelected&&e.search("example",c).then(function(a){200==a.status?(b.examples=a.results,b.showLoading=!1,g.push(c,"example",b.lang)):(b.examples=null,b.showLoading=!1,b.noResults=!0)},function(a){b.examples=null,b.showLoading=!1,b.noResults=!0});b.suggestSen=[],window.location.hash="#/search?type="+b.getCurrentType()+"&query="+c},b.changeKanjiShow=function(a){b.currentKanjiSelected=a},b.getCurrentKanji=function(){return b.kanjis[b.currentKanjiSelected]},b.kanjiSeletectClass=function(a){return b.currentKanjiSelected==a?"selected":""},b.getCurrentType=function(){switch(b.tabSelected){case 0:return"w";case 1:return"k";case 2:return"s";case 3:return"g"}return"w"},b.setTabByChar=function(a){var c=0;null==a||""==a?c=0:"w"==a?c=0:"k"==a?c=1:"e"==a?c=2:"g"==a?c=3:"s"==a&&(c=2),b.changeTypeSearch(c,!0)};var q=(h.type,h.query);b.setTabByChar(q),null!=q&&""!=q?(n=q,b.startQuery(q)):n="",b.$on("searchKanji",function(a,c){b.changeTypeSearch(1,!0),b.startQuery(c)}),b.showServerContent=!1,$("#search-text-box").on("input",function(){var a=$("#search-text-box").val();a=a.trim(),n=a,b.enterInput(a)}),b.showHistoryPanel=function(){$(".history-panel").addClass("open-history-panel"),$(".cover").css("display","block"),$("body").css("overflow","hidden")},b.showDetailSuggest=function(a){$(".icon_"+a).addClass("hiden"),$(".detail_"+a).removeClass("hiden"),$("."+a).addClass("hiden")},b.convertKindToReadable=function(a){return null==a||""==a?"":f.convertKindToReadable(a)},b.playAudio=function(a){var c="http://www.ispeech.org/p/generic/getaudio?text=",d="&voice=jpjapanesemale&speed=0&action=convert",e=c+a+d;b.sound=k.load(e),b.sound.play()},a.$on("chaneShowSuggest",function(a){o=j.getItem("showSuggest")});var r=100,s=function(a,b){function c(){40==window.event.keyCode?(document.getElementById("list-suggest-history").scrollTop=r,r+=40):38==window.event.keyCode&&(r-=40,document.getElementById("list-suggest-history").scrollTop=r)}var d=this;this.textbox=document.getElementById(a),this.div=document.getElementById(b),this.list=this.div.getElementsByTagName("div"),this.pointer=null,this.textbox.onkeydown=function(a){switch(a=a||window.event,a.keyCode){case 38:d.selectDiv(-1);break;case 40:d.selectDiv(1)}},this.selectDiv=function(a){if(this.pointer>1&&c(),0==this.pointer&&(document.getElementById("list-suggest-history").scrollTop=0),null!==this.pointer&&this.pointer+a>=0&&this.pointer+a<this.list.length){this.list[this.pointer].className="suggest-item",this.pointer+=a,this.list[this.pointer].className="active-suggest";var b=this.list[this.pointer].innerHTML;b=b.substring(56,b.length);for(var d=0;d<b.length;d++)if("<"==b[d]){b=b.substring(0,d);break}this.textbox.value=b}if(null===this.pointer){this.pointer=0,r=20,this.list[this.pointer].className="active-suggest";var b=this.list[this.pointer].innerHTML;b=b.substring(56,b.length);for(var d=0;d<b.length;d++)if("<"==b[d]){b=b.substring(0,d);break}this.textbox.value=b}}};$("body").removeClass("hidden"),f.showTitlePage()}]),angular.module("mazii").controller("NewsController",["$rootScope","$scope","$state","$timeout","maziiServ","dictUtilSer","historyServ","localstoreServ",function(a,b,c,d,e,f,g,h){b.showVideo=!1,a.title="Đọc báo";b.$on("changeDetailNews",function(a,c){e.getDetailNews(c.id).then(function(a){b.currentNews=a,b.showVideo=!1,-1==i.indexOf(a._id)&&(i.push(a._id),localStorage.setItem("news_read",JSON.stringify(i)))})}),b.playVideo=function(){b.showVideo=!0},b.getNewsReadClass=function(a){var b=-1!=i.indexOf(a)?"news_read":"";return b},b.checkLink=function(a){if(-1!=a.indexOf("http"))return a;for(var c=b.currentNews.link,d=0,e=c.length-1;e>=0;e--)if("/"==c[e]){d=e;break}return c=c.substring(0,d+1),c+a},b.getVideo=function(){return b.isMobile()?'<video class="movie-news-sm movie-news-md" controls>                     <source src="https://nhkmovs-i.akamaihd.net/i/news/'+b.currentNews.content.video+'/master.m3u8" type="video/mp4">                     Your browser does not support the video tag.                     </video>':'<object type="application/x-shockwave-flash" data="http://www3.nhk.or.jp/news/player5.swf" class="movie-news-sm movie-news-md" id="news_image_div3" style="visibility: visible;">             <param name="allowScriptAccess" value="sameDomain">             <param name="allowFullScreen" value="true">             <param name="wmode" value="direct">             <param name="quality" value="high">             <param name="bgcolor" value="#000000">             <param name="flashvars" value="fms=rtmp://flv.nhk.or.jp/ondemand/flv/news/&amp;movie='+b.currentNews.content.video+'"></object>'},b.getAudio=function(){var a=b.currentNews.content.audio;return a="http://www3.nhk.or.jp/news/easy/"+a.replace(".mp3","")+"/"+a,'<audio controls><source src="'+a+'" type="audio/mpeg"></audio>'},b.videoAvailable=function(){if("undefined"!=typeof device&&navigator.connection.type==Connection.NONE)return!1;var a=b.currentNews.content.video;return null==a||""==a?!1:!0},b.audioAvailable=function(){if("undefined"!=typeof device&&navigator.connection.type==Connection.NONE)return!1;var a=b.currentNews.content.audio;return null==a||""==a?!1:!0},b.imageAvailable=function(){if("undefined"!=typeof device&&navigator.connection.type==Connection.NONE)return!1;var a=b.currentNews.content.image;return null==a||""==a?!1:!0},b.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?!0:!1},e.getHeadNews().then(function(a){b.lastestNews=a;var c=a[0].value.id;e.getDetailNews(c).then(function(a){b.currentNews=a})});var i=JSON.parse(localStorage.getItem("news_read"));null==i&&(i=[]),$(document).on("click","a.dicWin",function(b){for(var c=$(b.currentTarget).find(".under"),d="",e=0;e<c.length;e++)d+=c[e].innerText;d=d.trim(),""!=d&&a.$broadcast("query",{type:"word",query:d})}),b.translate=function(){a.$broadcast("query",{type:"word",query:b.text}),$(".box-search").css("display","none")},b.selectText=function(){var a;window.Kolich||(a={}),a.Selector={},a.Selector.getSelected=function(){var a="";return window.getSelection?a=window.getSelection():document.getSelection?a=document.getSelection():document.selection&&(a=document.selection.createRange().text),a},a.Selector.mouseup=function(){var c=a.Selector.getSelected();""!=c&&(b.text=c.toString(),$(".box-search").css("display","block"),$(".box-search").css("left",b.x-100),$(".box-search").css("top",b.y-200))},$(document).ready(function(){$(document).bind("mouseup",a.Selector.mouseup)})},$(document).on("mousemove",function(a){b.x=a.pageX,b.y=a.pageY});var j=function(){var a=h.getItem("showFurigana");null!=a&&0==a?$("body").append('<style id="setting_css">rt{display: none;}</style>'):$("#setting_css").remove()};a.$on("changeShowFurigana",function(a){j()}),b.selectText(),j()}]),angular.module("mazii").controller("JLPTController",["$rootScope","$scope","$state","$timeout","maziiServ","dictUtilSer","historyServ","localstoreServ",function(a,b,c,d,e,f,g,h){b.level=5,b.checkFisrt=!1,b.type="kanji",b.page=0,b.length=0,b.firstlength=0,a.title="JLPT",b.inforJlpt=h.getItem("inforJLPT"),null!=b.inforJlpt&&(b.level=b.inforJlpt.level,b.type=b.inforJlpt.type,b.page=b.inforJlpt.page,b.length=b.inforJlpt.length,b.firstlength=b.inforJlpt.firstlength),b.selectType=function(a){b.length=0,b.type=a,b.page=0,b.query()},b.changeShowhanViet=function(){if(null==a.showhanViet){var c=h.getItem("showhanViet");null==c?b.showhanViet=!0:b.showhanViet=c}else b.showhanViet=a.showhanViet},b.selectLevel=function(a){b.length=0,b.level=a,b.page=0,b.query()},b.getBeautyTitleGrammar=function(a){return null==a?null:a.split("=>")[0]},b.getBeautyDescGrammar=function(a){if(null==a)return a;if(null==a.value||null==a.value.usages)return null;var b=a.value.usages[0].mean;return null!=b&&(b=b.replace(":","").replace("：","")),b=f.removeJapaneseChar(b)},b.query=function(){b.checkFisrt||null==!b.inforJlpt&&(b.type=b.inforJlpt.type,b.level=b.inforJlpt.level,b.page=b.inforJlpt.page),"grammar"==b.type?e.queryGrammarJLPT(b.level,b.page).then(function(a){b.list=a.results}):e.queryKanjiJLPT(b.level,b.page).then(function(a){b.list=a.results}),b.checkFisrt=!0;var a={type:b.type,level:b.level,page:b.page,length:b.length,firstlength:b.firstlength};h.setItem("inforJLPT",a),b.$applyAsync()};var i=!1,j=!1;b.getPreState=function(){return 0==b.page?(i=!1,"btn-disable"):(i=!0,"")},b.getNextState=function(){return null==b.list?(j=!0,""):"kanji"==b.type&&b.list.length<100?(j=!1,"btn-disable"):"grammar"==b.type&&b.list.length<30?(j=!1,"btn-disable"):(j=!0,"")},b.prePage=function(){0!=i&&(b.page--,b.page<0&&(b.page=0),"grammar"==b.type&&(b.length=b.length-b.firstlength),b.query())},b.nextPage=function(){0!=j&&(b.page++,"grammar"==b.type&&(b.firstlength=b.list.length,b.length+=b.list.length),b.query())},b.showKanji=function(b){a.$broadcast("query",{type:"kanji",query:b})},b.showGrammar=function(b){a.$broadcast("query",{type:"grammarDetail",query:b})},b.query(),b.changeShowhanViet(),b.$on("showhanViet",function(a){b.changeShowhanViet()})}]),angular.module("mazii").controller("NoteController",["$rootScope","$scope","$state","$timeout","noteServ","$stateParams","$location","dictUtilSer",function(a,b,c,d,e,f,g,h){b.category=e.getCategory(),b.state=!1,b.activeItem=null,a.title="Từ của tôi",b.getNoteItem=function(b){$(".note-item").removeClass("seleted-note"),a.$broadcast("getNoteItem",{cate:b})},b.showEdit=function(){$(".category-delete").toggleClass("hidden-note-delete")},b.deleteCategory=function(a){e.removeCategory(a)},b.getTime=function(a){var b=new Date(a);return b.toDateString()},b.getDeleteState=function(){return b.state?"":"hidden-note-delete"},b.showEdit=function(){0==b.state?b.state=!0:b.state=!1},h.showTitlePage()}]),angular.module("mazii").controller("HelpController",["$rootScope","dictUtilSer",function(a,b){a.title="Trợ giúp","undefined"==typeof FB||FB.XFBML.parse(),$("#forward-to-chat").click(function(a){document.getElementById("facebook-chat").scrollIntoView(),a.preventDefault()}),b.showTitlePage()}]),angular.module("mazii").controller("HeaderController",["$rootScope","$scope","$state","$timeout","maziiServ","dictUtilSer","historyServ",function(a,b,c,d,e,f,g){b.showMenuLeft=function(){$(".menu-left").addClass("open-menu-left"),$(".cover").css("display","block")},b.closePanel=function(){f.closePanel()},b.showHistory=function(){$(".history-panel").addClass("open-history-panel"),$(".cover").css("display","block"),$("body").css("overflow","hidden")},b.showSetting=function(){$(".setting-panel").addClass("open-setting-panel"),$(".cover").css("display","block"),$("body").css("overflow","hidden")}}]),angular.module("mazii").controller("WriteController",["$rootScope","$scope","$state","$timeout","maziiServ","dictUtilSer","historyServ","$stateParams","$location",function(a,b,c,d,e,f,g,h,i){b.form={},b.showDrawKanji=!1,a.title="Tập viết";var j=function(){var a=b.form.kanji;e.search("kanji",a).then(function(c){if(b.currentKanjiSelected=0,200==c.status){if(f.isJapanese(a)){var d=f.getKanjiChara(a);b.kanjis=f.sortHVDataByKeyWord(d,c.results),b.data=b.kanjis[0]}else b.kanjis=c.results,b.data=b.kanjis[0];b.showDrawKanji=!0,b.showResultNull=!1}else b.showResultNull=!0})};b.searchKanji=function(){j()},f.showTitlePage()}]),angular.module("mazii").controller("AboutController",["$rootScope","dictUtilSer",function(a,b){a.title="Về Mazii",b.showTitlePage()}]),angular.module("mazii").controller("ChatController",["$rootScope","$scope","$state","localstoreServ","authServ","maziiServ","dictUtilSer",function(a,b,c,d,e,f,g){b.tab_1="menu-active",b.tabActive=1,b.user=a.user;var h=a.user;b.listMessage=[],b.listUser=[],b.listmessageReceive=[],b.listMessagePrivate=[],b.countMessage=0,b.newMessage=!1,b.formChat={},b.loadDone=!1,b.tabScreen=0,b.titleBar="Nhóm chung";var i=io.connect(SERVER_ADRESS),j=[],k=0,l=0,m=0,n=function(){i.emit("get-list-message-private-in-public",h),i.emit("get-list-data")},o=function(){$(".chat-public .list-message").animate({scrollTop:1e4},500)},p=function(){h=a.user,b.user=a.user,"undefined"==typeof h||null==h||""==h?(b.showLogin=!0,console.log("not login")):(b.showLogin=!1,i.emit("reset-socket-user",h),n(),console.log("logined"))};null!=a.user?(p(),b.loadDone=!0):(b.loadDone=!0,b.showLogin=!1),b.changeTab=function(a){b.tabActive=a,1==a?(b.tab_1="menu-active",b.tab_2=b.tab_3="",b.tabScreen=0,$(".main-chat .list-message li.list-group-item").removeClass("group-jlpt-active"),$(".main-chat .list-message .group-0"+a).addClass("group-jlpt-active"),b.titleBar="Nhóm chung"):2==a?(b.tab_2="menu-active",b.tab_1=b.tab_3="",b.titleBar="Danh sách tin nhắn",b.newMessage=!1):(b.tab_3="menu-active",b.tab_2=b.tab_1="",b.titleBar="Danh sách người dùng",b.tabScreen=7,$(".chat-list-user").scroll(function(){var a=$(".chat-list-user").scrollTop();a>0&&20>a&&(++m,i.emit("load-more-user",m))}))},b.changeScreen=function(a){switch(b.tabScreen=a,k=0,$(".main-chat .list-message li.list-group-item").removeClass("group-jlpt-active"),$(".main-chat .list-message .group-"+a).addClass("group-jlpt-active"),i.emit("get-list-message-jltp",a),a){case 0:b.titleBar="Nhóm chung";break;default:b.titleBar="Nhóm nhóm JLPT "+a}},b.loginFacebook=function(){e.loginFacebook().then(function(a){null!=a&&i.emit("user-join-public",a)})},b.logoutFacebook=function(){e.logoutFacebook(),h=b.user=a.user=null,p(),q(),b.$$phase||b.$apply()};var q=function(){b.tab_1="menu-active",b.tabActive=1,b.listMessage=[],b.listUser=[],b.listmessageReceive=[],b.listMessagePrivate=[],b.countMessage=0,b.newMessage=!1,b.tabScreen=0};i.on("reset-socket-success",function(c){h=c,a.user=h,b.user=h}),i.on("login-success",function(c){console.log(c),a.user=c,b.user=c,h=c,n(),b.showLogin=!1,b.$apply()}),i.on("get-list-message",function(a){var c,d=a.length;b.listMessage=[];for(var e=0;d>e;e++){var c=a[e].index;if(g.renderHtmlMessage(a[e]).length>1)var f=g.renderHtmlMessage(a[e]),h={_id:a[e]._id,username:a[e].username,index:c,message:f,date_send:a[e].date_send,userId:a[e].userId,newLine:!0};else var h={_id:a[e]._id,username:a[e].username,message:a[e].content,index:c,date_send:a[e].date_send,userId:a[e].userId,newLine:!1};b.listMessage.unshift(h)}b.$apply(),0!=c&&$("#list-message-"+c).scroll(function(){var a=$("#list-message-"+c).scrollTop();a>0&&20>a&&(++k,i.emit("load-more-message-jlpt",{index:c,indexMessage:k}))}),o()}),i.on("get-list-user",function(a){var c=a.length;b.listUser=[];for(var d=0;c>d;d++){var e=a[d];(null==h||e.fbId!=h.fbId)&&b.listUser.push(e)}b.$apply()}),i.on("add-user-public",function(a){(null==h||a._id!=h._id)&&(b.listUser.push(a),b.$apply())}),i.on("receive-message-public",function(a){if(g.renderHtmlMessage(a).length>1){var c=g.renderHtmlMessage(a),d={_id:a._id,username:a.username,index:a.index,message:c,date_send:a.date_send,userId:a.userId,newLine:!0};b.listMessage.push(d)}else{var d={_id:a._id,username:a.username,message:a.content,index:a.index,date_send:a.date_send,userId:a.userId,newLine:!1};b.listMessage.push(d)}o(),b.$apply()}),b.formChat.sendChat=function(a){r(a)},b.formChat.enterChat=function(a,b){13==a.keyCode&&(a.shiftKey||(r(b),a.preventDefault()))};var r=function(a){var c=$("#enter-chat-message-"+a).val(),c=c.trim();if(null!=c&&""!=c)if(null==h||""==h)b.loginFacebook();else{var d={user:b.user,message:c,index:a};i.emit("send-message-public",d),$("#enter-chat-message-"+a).val("")}};i.on("receive-list-message-private-in-public",function(a){var c=b.listmessageReceive.length;if(0==c)b.listmessageReceive.push(a),j.push(a.your_id);else for(var d=0;c>d;d++)if(-1==j.indexOf(a.your_id))j.push(a.your_id),b.listmessageReceive.push(a),b.newMessage=!0;else{for(var c=b.listmessageReceive.length,e=0,f=0;c>f;f++){var g=b.listmessageReceive[d];g.your_id==a.your_id&&(b.listmessageReceive[f]=a,e++)}0==e&&(0==a.status&&1==a.flag&&(b.newMessage=!0),b.listmessageReceive.push(a))}for(var d=0;d<b.listmessageReceive.length;d++)b.newMessage=0,0==b.listmessageReceive[d].status&&1==b.newMessage;b.$apply()}),b.redirectChatPrivate=function(a){b.userReceive={_id:a._id,username:a.username},b.titleBar="Chat với "+a.username,b.newMessage=!1,b.tabScreen=6;({userSend:b.user,userReceive:b.userReceive});i.emit("contruct-chat-private",{userReceive:b.userReceive,userSend:b.user}),i.on("read-message-private",{userReceive:b.userReceive,userSend:b.user}),l=0,b.$apply()},b.redirectChatPrivatetoDetailUser=function(a){if(a.userId!=b.user._id){var c={_id:a.userId,username:a.username};b.redirectChatPrivate(c)}},b.redirectChatPrivatetoListMessage=function(a){var c={_id:a.your_id,username:a.your_username};b.redirectChatPrivate(c),0==a.status&&(b.newMessage=!1)},b.formChat.sendChatPrivate=function(){s()},b.formChat.enterChatPrivate=function(a){13==a.keyCode&&(a.shiftKey||(s(),a.preventDefault()))};var s=function(){var a=$("#enter-chat-message-6").val();if(a=a.trim(),null!=a&&""!=a){var c={userSend:b.user,userReceive:b.userReceive,message:a};i.emit("send-message-private",c),$("#enter-chat-message-6").val().replace(/\n/g,""),$("#enter-chat-message-6").val("")}};i.on("get-more-message",function(a){if(null!=a&&0!=a.length){$(".list-message-0").scrollTop(50);for(var c=a.length,d=0;c>d;d++){a[d];if(g.renderHtmlMessage(a[d]).length>1)var e=g.renderHtmlMessage(a[d]),f={_id:a[d]._id,username:a[d].username,index:a[d].index,message:e,date_send:a[d].date_send,userId:a[d].userId,newLine:!0};else var f={_id:a[d]._id,username:a[d].username,message:a[d].content,index:a[d].index,date_send:a[d].date_send,userId:a[d].userId,newLine:!1};b.listMessage.unshift(f)}b.$apply()}}),i.on("get-more-user",function(a){if(null!=a&&0!=a.length){for(var c=a.length,d=0;c>d;d++)b.listUser.unshift(a[d]);b.$apply()}}),i.on("receive-load-more-message-private",function(a){if(0!=a.length){$(".list-message-private").animate({scrollTop:100},500);for(var c=a.length,d=0;c>d;d++){var e=a[d];b.listMessagePrivate.unshift(e)}b.$apply()}}),i.on("receive-message-pravite",function(a){g.renderHtmlMessagePrivate(a).length>1?(a.newLine=!0,a.message=g.renderHtmlMessagePrivate(a)):a.newLine=!1,b.listMessagePrivate.push(a),$(".list-message-private").animate({scrollTop:1e4},500);for(var c=b.listmessageReceive.length,d=0,e=0;c>e;e++){var f=b.listmessageReceive[e];f.your_username==a.your_username&&(b.listmessageReceive[e]=a,d++)}0==d&&b.listmessageReceive.push(a),0==a.status&&1==a.flag&&(b.newMessage=!0,b.$apply()),b.$apply()}),i.on("receive-list-chat-private",function(a){a.reverse(),b.listMessagePrivate=a,b.$apply(),$(".list-message-private").animate({scrollTop:1e4},500),$("#list-message-6").scroll(function(){var a=$("#list-message-6").scrollTop();a>0&&20>a&&(++l,i.emit("load-more-message-private",{userReceive:b.userReceive,userSend:b.user,index:l}))})}),b.$on("loadFBDone",function(){p(),b.loadDone=!0,b.$$phase||b.$apply()}),setTimeout(function(){$("#list-message-0").scroll(function(){var a=$("#list-message-0").scrollTop();a>0&&20>a&&(++k,i.emit("load-more-message",k))})},2e3),b.showDetailUser=function(a){$(".detail-user-"+a).slideDown(100)},$("*").click(function(a){$(a.target);$(a.target).is(".avatar")||$(".detail-user").slideUp(100)}),b.translateMessage=function(a,b){"object"==typeof a&&(a=a.toString(),a=a.replace(/,/g," "));var c=$(".text-"+b+" > .trans");0==c.length&&null!=!c&&(g.isJapanese(a)?f.googleTranslate(a,"ja","vi").then(function(a){var c=a.sentences[0].trans;c='<p class="trans">'+c+"</p>",$(".text-"+b).append(c)}):f.googleTranslate(a,"vi","ja").then(function(a){var c=a.sentences[0].trans;c='<p class="trans">'+c+"</p>",$(".text-"+b).append(c)}))}}]),angular.module("mazii").controller("TermController",["$rootScope",function(a){a.title="Từ của tôi"}]);